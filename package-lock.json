import { parseISO, addDays, addWeeks, addMonths, addYears, addHours, endOfISOWeek } from 'date-fns';


export const newDateFutureParser = (DATE: string ,PREFIX: string, hasDay: boolean, hasWeek: boolean, hasMonth: boolean, hasYear: boolean, ): string => {
        console.log(13);
        console.log('STARTING NEW DATE FUTURE PARSER');
        


        function isIsoFormat(s: string): boolean {
            const pattern = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z)?$/;
            return pattern.test(s);
        }

        
        const match = (i: string) => i.match(/\d+/);
        const firstNumber = (match: RegExpMatchArray | null) => (match ? parseInt(match[0]) : 0)

        if (DATE) {
            const current_date: Date = new Date()
            current_date.setHours(current_date.getHours() + 3)
            console.log(isIsoFormat(DATE));

            const dateString: string = isIsoFormat(DATE) ? DATE : current_date.toISOString();
            console.log(dateString);
            let parsedDate: Date = parseISO(dateString);
            parsedDate.setHours(parsedDate.getHours())

            console.log(2222);
            console.log(parsedDate);
            const parsedDate1 = parsedDate;
            console.log(parsedDate1);

            if(dateString === current_date.toISOString()) {
                console.log(117)
                parsedDate.setHours(parsedDate.getHours() + 3);
            }

            if(dateString === current_date.toISOString()) {
                console.log(118)
                const newTime = addHours(parsedDate1,parsedDate1.getHours() + 3)
                console.log(newTime);
                
            }

            console.log(parsedDate1);
            
            console.log(parsedDate);
            console.log('FUTURETIME1 ' + parsedDate );
            
            

            if (hasDay) { // 2 дня
                if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                    console.log('DateParser есть дни и есть префикс вперед ');
                    console.log(DATE);
                    console.log(firstNumber(match(DATE))); 
                    const additionalDays = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                    parsedDate.setDate(parsedDate.getDate() + additionalDays);
                    console.log('DateParser есть дни и есть префикс вперед вывод:');
                    console.log(parsedDate);
                    console.log(typeof parsedDate);
                } else {
                    console.log('DateParser есть дни и нет префикс вперед ');
                    const additionalDays = firstNumber(match(DATE));
                    parsedDate.setDate(parsedDate.getDate() + additionalDays);
                    console.log('DateParser есть дни и нет префикс вперед вывод:');
                    console.log(parsedDate);
                    console.log(typeof parsedDate);
                } 
            } 
            if (hasWeek) { // 2 недели
                if (['следующ'].some(word => PREFIX.includes(word))) {
                    console.log('DateParser есть недели и есть префикс следующий ');
                    const today = new Date()
                    const nextWeekDay = endOfISOWeek(today)
                    const h = 10
                    console.log('HOURS ' + h);
                    const m = 0
                    console.log('HOURS ' + m);
                    nextWeekDay.setHours(h,m,0,0)
                    nextWeekDay.setDate(nextWeekDay.getDate()+1)
                    parsedDate.setDate(nextWeekDay.getDate())
                    parsedDate.setHours(h,m,0,0)
                    console.log('DateParser есть недели и есть префикс следующий вывод:');
                    console.log(nextWeekDay.getDate());
                    console.log(parsedDate);
                } else if  (['через', 'позже', 'вперед','поздний'].some(word => PREFIX.includes(word))) {
                    console.log('DateParser есть недели и есть префикс вперед ');
                    const additionalWeeks = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                    const days = additionalWeeks*7 
                    parsedDate.setDate(parsedDate.getDate() + days);
                    console.log('DateParser есть недели и есть префикс вперед вывод:');
                    console.log(parsedDate);
                    console.log(typeof parsedDate);
                } else {
                    console.log('DateParser есть недели и нет префикс вперед ');
                    const additionalWeeks = firstNumber(match(DATE));
                    const days = additionalWeeks*7 
                    parsedDate.setDate(parsedDate.getDate() + days);
                    console.log('DateParser есть недели и нет префикс вперед вывод:');
                    console.log(parsedDate);
                    console.log(typeof parsedDate);
                } 
            }
            if (hasMonth) { // 2 месяца
                if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                    console.log('DateParser есть месяцы и есть префикс вперед ');
                    const additionalMonthes = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                    parsedDate.setMonth(parsedDate.getMonth() + additionalMonthes);
                    console.log('DateParser есть месяцы и есть префикс вперед вывод:');
                    console.log(parsedDate);
                    console.log(typeof parsedDate);
                } else {
                    console.log('DateParser есть месяцы и нет префикс вперед ');
                    const additionalMonthes = firstNumber(match(DATE));
                    parsedDate.setMonth(parsedDate.getMonth() + additionalMonthes);
                    console.log('DateParser есть месяцы и нет префикс вперед вывод:');
                    console.log(parsedDate);
                    console.log(typeof parsedDate);
                } 
            } 
            if (hasYear) { // 2 года
                if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                    console.log('DateParser есть годы и есть префикс вперед ');
                    const additionalYears = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                    parsedDate.setFullYear(parsedDate.getFullYear() + additionalYears);
                    console.log('DateParser есть годы и есть префикс вперед вывод:');
                    console.log(parsedDate);
                    console.log(typeof parsedDate);
                } else {
                    console.log('DateParser есть годы и нет префикс вперед ');
                    const additionalYears = firstNumber(match(DATE));
                    parsedDate.setFullYear(parsedDate.getFullYear() + additionalYears);
                    console.log('DateParser есть годы и нет префикс вперед вывод:');
                    console.log(parsedDate);
                    console.log(typeof parsedDate);
                } 
            }
            console.log(parsedDate);
            console.log('FUTURETIME1 ' + parsedDate );
            console.log(parsedDate);
            console.log('FUTURETIME1 ' + parsedDate.toISOString() );
            


            return parsedDate.toISOString()
        } else {

            console.log('DateParser !DATE');
            const current_date: Date = new Date()
            current_date.setHours(current_date.getHours() + 3)
            const dateString: string = isIsoFormat(DATE) ? DATE : current_date.toISOString();
            const parsedDate = parseISO(dateString);
            parsedDate.setHours(parsedDate.getHours() + 3)
            const futureTime = addDays(parsedDate, 1)
            console.log('DateParser !TIME вывод:');    
            console.log(futureTime);
            console.log(typeof futureTime);
                
            return futureTime.toISOString()
        }
};

export const newDateFuturePastParser = (DATE: string ,PREFIX: string, hasDay: boolean, hasWeek: boolean, hasMonth: boolean, hasYear: boolean, ): string => {
    console.log(13);
    console.log(DATE);
    


    function isIsoFormat(s: string): boolean {
        const pattern = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z)?$/;
        return pattern.test(s);
    }

    
    const match = (i: string) => i.match(/\d+/);
    const firstNumber = (match: RegExpMatchArray | null) => (match ? parseInt(match[0]) : 0)

    if (DATE) {
        const current_date: Date = new Date()
        current_date.setHours(current_date.getHours() + 3)


        const dateString: string = isIsoFormat(DATE) ? DATE : current_date.toISOString();

        const parsedDate = parseISO(dateString);
        const parsedDate1 = parseISO(dateString);
        parsedDate.setHours(parsedDate.getHours() + 3)
        parsedDate1.setHours(parsedDate.getHours() + 3)


        console.log(parsedDate1);
        
        console.log(parsedDate);
        console.log('FUTURETIME1 ' + parsedDate );
        
        

        if (hasDay) { // 2 дня
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть дни и есть префикс вперед ');
                console.log(DATE);
                console.log(firstNumber(match(DATE))); 
                const additionalDays = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setDate(parsedDate.getDate() + additionalDays);
                console.log('DateParser есть дни и есть префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            }  else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть дни и есть префикс назад ');
                const additionalDays = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setDate(parsedDate.getDate() - additionalDays);
                console.log('DateParser есть дни и есть префикс назад вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else {
                console.log('DateParser есть дни и нет префикс вперед ');
                const additionalDays = firstNumber(match(DATE));
                parsedDate.setDate(parsedDate.getDate() + additionalDays);
                console.log('DateParser есть дни и нет префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } 
        } 
        if (hasWeek) { // 2 недели
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть недели и есть префикс вперед ');
                const additionalWeeks = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                const days = additionalWeeks*7 
                parsedDate.setDate(parsedDate.getDate() + days);
                console.log('DateParser есть недели и есть префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            }  else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть недели и есть префикс назад ');
                const additionalWeeks = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                const days = additionalWeeks*7 
                parsedDate.setDate(parsedDate.getDate() - days);
                console.log('DateParser есть недели и есть префикс назад вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else {
                console.log('DateParser есть недели и нет префикс вперед ');
                const additionalWeeks = firstNumber(match(DATE));
                const days = additionalWeeks*7 
                parsedDate.setDate(parsedDate.getDate() + days);
                console.log('DateParser есть недели и нет префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } 
        }
        if (hasMonth) { // 2 месяца
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть месяцы и есть префикс вперед ');
                const additionalMonthes = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setMonth(parsedDate.getMonth() + additionalMonthes);
                console.log('DateParser есть месяцы и есть префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть месяцы и есть префикс назад ');
                const additionalMonthes = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setMonth(parsedDate.getMonth() - additionalMonthes);
                console.log('DateParser есть месяцы и есть префикс назад вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else {
                console.log('DateParser есть месяцы и нет префикс вперед ');
                const additionalMonthes = firstNumber(match(DATE));
                parsedDate.setMonth(parsedDate.getMonth() + additionalMonthes);
                console.log('DateParser есть месяцы и нет префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } 
        } 
        if (hasYear) { // 2 года
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть годы и есть префикс вперед ');
                const additionalYears = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setFullYear(parsedDate.getFullYear() + additionalYears);
                console.log('DateParser есть годы и есть префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть годы и есть префикс назад ');
                const additionalYears = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setFullYear(parsedDate.getFullYear() - additionalYears);
                console.log('DateParser есть годы и есть префикс назад вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else {
                console.log('DateParser есть годы и нет префикс вперед ');
                const additionalYears = firstNumber(match(DATE));
                parsedDate.setFullYear(parsedDate.getFullYear() + additionalYears);
                console.log('DateParser есть годы и нет префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } 
        }

        console.log(parsedDate);
        console.log('FUTURETIME1 ' + parsedDate.toISOString() );
        
        return parsedDate.toISOString()
    } else {

        console.log('DateParser !DATE');
        const current_date: Date = new Date()
        current_date.setHours(current_date.getHours() + 3)
        const dateString: string = isIsoFormat(DATE) ? DATE : current_date.toISOString();
        const parsedDate = parseISO(dateString);
        parsedDate.setHours(parsedDate.getHours() + 3)
        const futureTime = addDays(parsedDate, 1)
        console.log('DateParser !TIME вывод:');    
        console.log(futureTime);
        console.log(typeof futureTime);
            
        return futureTime.toISOString()
    }
};

export const newDateFuturePastSearchParser = (DATE: string ,PREFIX: string, hasDay: boolean, hasWeek: boolean, hasMonth: boolean, hasYear: boolean, ): string => {
    console.log(13);


    function isIsoFormat(s: string): boolean {
        const pattern = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z)?$/;
        return pattern.test(s);
    }

    
    const match = (i: string) => i.match(/\d+/);
    const firstNumber = (match: RegExpMatchArray | null) => (match ? parseInt(match[0]) : 0)

    if (DATE) {
        const current_date: Date = new Date()
        current_date.setHours(current_date.getHours() + 3)

        const dateString: string = isIsoFormat(DATE) ? DATE : current_date.toISOString();

        const parsedDate = parseISO(dateString);
        const parsedDate1 = parseISO(dateString);

        parsedDate.setHours(parsedDate.getHours() + 3)
        parsedDate1.setHours(parsedDate.getHours() + 3)

        console.log(parsedDate1);
        
        console.log(parsedDate);
        console.log('FUTURETIME1 ' + parsedDate );
        
        

        if (hasDay) { // 2 дня
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть дни и есть префикс вперед ');
                console.log(DATE);
                console.log(firstNumber(match(DATE))); 
                const additionalDays = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setDate(parsedDate.getDate() + additionalDays);
                console.log('DateParser есть дни и есть префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            }  else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть дни и есть префикс назад ');
                const additionalDays = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setDate(parsedDate.getDate() - additionalDays);
                console.log('DateParser есть дни и есть префикс назад вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else {
                console.log('DateParser есть дни и нет префикс вперед ');
                const additionalDays = firstNumber(match(DATE));
                parsedDate.setDate(parsedDate.getDate() + additionalDays);
                console.log('DateParser есть дни и нет префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } 
        } 
        if (hasWeek) { // 2 недели
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть недели и есть префикс вперед ');
                const additionalWeeks = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                const days = additionalWeeks*7 
                parsedDate.setDate(parsedDate.getDate() + days);
                console.log('DateParser есть недели и есть префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            }  else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть недели и есть префикс назад ');
                const additionalWeeks = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                const days = additionalWeeks*7 
                parsedDate.setDate(parsedDate.getDate() - days);
                console.log('DateParser есть недели и есть префикс назад вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else {
                console.log('DateParser есть недели и нет префикс вперед ');
                const additionalWeeks = firstNumber(match(DATE));
                const days = additionalWeeks*7 
                parsedDate.setDate(parsedDate.getDate() + days);
                console.log('DateParser есть недели и нет префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } 
        }
        if (hasMonth) { // 2 месяца
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть месяцы и есть префикс вперед ');
                const additionalMonthes = firstNumber(match(DATE)) > 0 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setMonth(parsedDate.getMonth() + additionalMonthes);
                console.log('DateParser есть месяцы и есть префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть месяцы и есть префикс назад ');
                const additionalMonthes = firstNumber(match(DATE)) > 0 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setMonth(parsedDate.getMonth() - additionalMonthes);
                console.log('DateParser есть месяцы и есть префикс назад вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else {
                console.log('DateParser есть месяцы и нет префикс вперед ');
                const additionalMonthes = firstNumber(match(DATE));
                parsedDate.setMonth(parsedDate.getMonth() + additionalMonthes);
                console.log('DateParser есть месяцы и нет префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } 
        } 
        if (hasYear) { // 2 года
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть годы и есть префикс вперед ');
                const additionalYears = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setFullYear(parsedDate.getFullYear() + additionalYears);
                console.log('DateParser есть годы и есть префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть годы и есть префикс назад ');
                const additionalYears = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                parsedDate.setFullYear(parsedDate.getFullYear() - additionalYears);
                console.log('DateParser есть годы и есть префикс назад вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } else {
                console.log('DateParser есть годы и нет префикс вперед ');
                const additionalYears = firstNumber(match(DATE));
                parsedDate.setFullYear(parsedDate.getFullYear() + additionalYears);
                console.log('DateParser есть годы и нет префикс вперед вывод:');
                console.log(parsedDate);
                console.log(typeof parsedDate);
            } 
        }

        console.log(parsedDate);
        console.log('FUTURETIME1 ' + parsedDate.toISOString() );
        
        return parsedDate.toISOString()
    } else {

        console.log('DateParser !DATE');
        const current_date: Date = new Date()
        current_date.setHours(current_date.getHours() + 3)
        const dateString: string = isIsoFormat(DATE) ? DATE : current_date.toISOString();
        const parsedDate = parseISO(dateString);
        parsedDate.setHours(parsedDate.getHours() + 3)
        const futureTime = addDays(parsedDate, 1)
        console.log('DateParser !TIME вывод:');    
        console.log(futureTime);
        console.log(typeof futureTime);
            
        return futureTime.toISOString()
    }
};

















export const newDateFuturePastUpdateParser = (DATE: string ,FIRSTDATE: string, PREFIX: string, hasDay: boolean, hasWeek: boolean, hasMonth: boolean, hasYear: boolean, ): string => {
    console.log(13);


    function isIsoFormat(s: string): boolean {
        const pattern = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z)?$/;
        return pattern.test(s);
    }

    
    const match = (i: string) => i.match(/\d+/);
    const firstNumber = (match: RegExpMatchArray | null) => (match ? parseInt(match[0]) : 0)

    if (DATE) {
        const current_date: Date = new Date()
        current_date.setHours(current_date.getHours() + 3)

        const dateString: string = isIsoFormat(DATE) ? DATE : current_date.toISOString();

        const parsedDate = parseISO(dateString);
        const parsedDate1 = parseISO(dateString);
        let firstDate = parseISO(FIRSTDATE)
        firstDate.setHours(firstDate.getHours())

        parsedDate.setHours(parsedDate.getHours() + 3)
        parsedDate1.setHours(parsedDate.getHours() + 3)

        console.log(parsedDate1);
        
        console.log(parsedDate);
        console.log('FUTURETIME1 ' + parsedDate );
        
        

        if (hasDay) { // 2 дня
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть дни и есть префикс вперед ');
                console.log(DATE);
                console.log(firstNumber(match(DATE))); 
                const additionalDays = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                firstDate.setDate(firstDate.getDate() + additionalDays);
                console.log('DateParser есть дни и есть префикс вперед вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            }  else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть дни и есть префикс назад ');
                const additionalDays = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                firstDate.setDate(firstDate.getDate() - additionalDays);
                console.log('DateParser есть дни и есть префикс назад вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } else {
                console.log('DateParser есть дни и нет префикс вперед ');
                const additionalDays = firstNumber(match(DATE));
                firstDate.setDate(firstDate.getDate() + additionalDays);
                console.log('DateParser есть дни и нет префикс вперед вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } 
        } else
        if (hasWeek) { // 2 недели
            if (['следующ'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть недели и есть префикс следующий ');
                const today = new Date()
                const nextWeekDay = endOfISOWeek(today)
                const h = parseInt(FIRSTDATE.substring(11,13))+3
                console.log('HOURS' + h);
                const m = parseInt(FIRSTDATE.substring(14,16))
                console.log('HOURS' + m);
                nextWeekDay.setHours(h,m,0,0)
                nextWeekDay.setDate(nextWeekDay.getDate()+1)
                firstDate = nextWeekDay
                console.log('DateParser есть недели и есть префикс следующий вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } else if  (['через', 'позже', 'вперед','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть недели и есть префикс вперед ');
                const additionalWeeks = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                const days = additionalWeeks*7 
                firstDate.setDate(firstDate.getDate() + days);
                console.log('DateParser есть недели и есть префикс вперед вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            }  else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть недели и есть префикс назад ');
                const additionalWeeks = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                const days = additionalWeeks*7 
                firstDate.setDate(firstDate.getDate() - days);
                console.log('DateParser есть недели и есть префикс назад вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } else {
                console.log('DateParser есть недели и нет префикс вперед ');
                const additionalWeeks = firstNumber(match(DATE));
                const days = additionalWeeks*7 
                firstDate.setDate(firstDate.getDate() + days);
                console.log('DateParser есть недели и нет префикс вперед вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } 
        } else
        if (hasMonth) { // 2 месяца
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть месяцы и есть префикс вперед ');
                const additionalMonthes = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                firstDate.setMonth(firstDate.getMonth() + additionalMonthes);
                console.log('DateParser есть месяцы и есть префикс вперед вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть месяцы и есть префикс назад ');
                const additionalMonthes = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                firstDate.setMonth(firstDate.getMonth() - additionalMonthes);
                console.log('DateParser есть месяцы и есть префикс назад вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } else {
                console.log('DateParser есть месяцы и нет префикс вперед ');
                const additionalMonthes = firstNumber(match(DATE));
                firstDate.setMonth(firstDate.getMonth() + additionalMonthes);
                console.log('DateParser есть месяцы и нет префикс вперед вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } 
        } else if (hasYear) { // 2 года
            if (['через', 'позже', 'вперед','следующ','поздний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть годы и есть префикс вперед ');
                const additionalYears = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                firstDate.setFullYear(firstDate.getFullYear() + additionalYears);
                console.log('DateParser есть годы и есть префикс вперед вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } else if (['раньше', 'назад','ранний'].some(word => PREFIX.includes(word))) {
                console.log('DateParser есть годы и есть префикс назад ');
                const additionalYears = firstNumber(match(DATE)) >= 1 ? firstNumber(match(DATE))  : firstNumber(match(DATE)) + 1
                firstDate.setFullYear(firstDate.getFullYear() - additionalYears);
                console.log('DateParser есть годы и есть префикс назад вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } else {
                console.log('DateParser есть годы и нет префикс вперед ');
                const additionalYears = firstNumber(match(DATE));
                firstDate.setFullYear(firstDate.getFullYear() + additionalYears);
                console.log('DateParser есть годы и нет префикс вперед вывод:');
                console.log(firstDate);
                console.log(typeof firstDate);
            } 
        } else {

            console.log(parsedDate);
            console.log('FUTURETIME1 ' + parsedDate.toISOString() );
            
            return parsedDate.toISOString().substring(0,11)+FIRSTDATE.substring(11)
        }
        console.log(firstDate);
        console.log('FUTURETIME1 ' + firstDate.toISOString() );
        
        return firstDate.toISOString()
    } else {

        console.log('DateParser !DATE');
        const current_date: Date = new Date()
        current_date.setHours(current_date.getHours() + 3)
        const dateString: string = isIsoFormat(DATE) ? DATE : current_date.toISOString();
        const parsedDate = parseISO(dateString);
        parsedDate.setHours(parsedDate.getHours() + 3)
        const futureTime = addDays(parsedDate, 1)
        console.log('DateParser !TIME вывод:');    
        console.log(futureTime);
        console.log(typeof futureTime);
            
        return futureTime.toISOString()
    }
};
